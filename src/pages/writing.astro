---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

// Get published blog posts, sorted by date (newest first)
const posts = (await getCollection('blog', ({ data }) => !data.draft))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<Layout title="Writing | Amitoj Singh" description="Essays on technology, contemplative practice, and human flourishing.">
  <section class="container-zen section-zen">
    <div class="max-w-2xl">
      <h1 class="mb-8 text-balance">Writing</h1>

      <div class="accent-line mb-8"></div>

      <p class="text-lg text-ink-light mb-6">
        Essays exploring the intersection of technology, contemplative practice,
        and human flourishing.
      </p>
    </div>
  </section>

  <section class="container-zen section-zen border-t border-oat-300">
    {posts.length > 0 ? (
      <ul class="list-none m-0 p-0 space-y-8">
        {posts.map((post) => (
          <li class="border-b border-oat-300 pb-8 last:border-0">
            <a href={`/blog/${post.slug}`} class="no-underline group block">
              <article>
                <h2 class="text-2xl mb-2 group-hover:text-ink-light transition-colors">
                  {post.data.title}
                </h2>
                <p class="text-ink-muted text-sm mb-3">
                  {post.data.pubDate.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                  })}
                </p>
                {post.data.description && (
                  <p class="text-ink-light">
                    {post.data.description}
                  </p>
                )}
                {post.data.tags.length > 0 && (
                  <div class="flex gap-2 mt-3">
                    {post.data.tags.map((tag) => (
                      <span class="text-xs text-ink-muted bg-oat-100 px-2 py-1">
                        {tag}
                      </span>
                    ))}
                  </div>
                )}
              </article>
            </a>
          </li>
        ))}
      </ul>
    ) : (
      <div class="max-w-2xl">
        <p class="text-ink-muted italic mb-6">
          Essays coming soon.
        </p>
        <p class="text-ink-light">
          In the meantime, feel free to <a href="/contact">get in touch</a> to discuss
          ideas around technology, contemplative practice, or human flourishing.
        </p>
      </div>
    )}
  </section>
</Layout>
