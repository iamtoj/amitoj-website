---
import Layout from '../layouts/Layout.astro';
import fs from 'node:fs';
import path from 'node:path';

// Read images from public/images/photography/ folder
// User exports photos there; /next sync picks them up
//
// ORDERING: Files sort alphabetically. To control order:
//   01-photo.jpg, 02-photo.jpg, 03-photo.jpg
// Or use date prefixes: 2024-01-15-photo.jpg
const photographyDir = 'public/images/photography-optimized';
let galleryImages: { src: string; alt: string }[] = [];

try {
  const publicDir = path.join(process.cwd(), photographyDir);
  if (fs.existsSync(publicDir)) {
    const files: string[] = fs.readdirSync(publicDir)
      .filter((f: string) => /\.(webp)$/i.test(f))
      .sort(); // Alphabetical - prefix with numbers for ordering

    galleryImages = files.map((file: string) => ({
      src: `/images/photography-optimized/${file}`,
      alt: file.replace(/\.[^.]+$/, '').replace(/[-_]/g, ' ').replace(/^\d+\s*/, '') // Remove number prefix from alt text
    }));
  }
} catch (e) {
  // If folder doesn't exist yet, show placeholder message
}
---

<Layout title="Photography | Amitoj Singh" description="Visual explorations. Seeing as practice.">
  <section class="container-zen section-zen">
    <div class="max-w-2xl">
      <h1 class="mb-8 text-balance">Photography</h1>

      <div class="accent-line mb-8"></div>

      <p class="text-lg text-ink-light mb-6">
        Seeing as practice. Light as language.
      </p>
    </div>
  </section>

  {galleryImages.length === 0 ? (
    <section class="container-zen section-zen border-t border-oat-300">
      <p class="text-ink-muted">
        Gallery coming soon. Export photos to <code>Work/Website/public/images/photography-optimized/</code>.
      </p>
    </section>
  ) : (
    <section class="container-zen section-zen border-t border-oat-300">
      <div class="masonry-grid">
        {galleryImages.map((image) => (
          <figure class="masonry-item">
            <img
              src={image.src}
              alt={image.alt}
              loading="lazy"
            />
          </figure>
        ))}
      </div>
    </section>
  )}

  <section class="container-zen section-zen border-t border-oat-300 bg-oat-100">
    <div class="max-w-2xl">
      <h2 class="text-2xl mb-6 section-header">Inquiries</h2>

      <p class="text-ink-light mb-8">
        For prints, licensing, or collaboration inquiries, please get in touch.
      </p>

      <a href="/contact" class="arrow-link">Contact</a>
    </div>
  </section>
</Layout>

<style>
  /* Masonry grid using CSS columns - larger photos (2 across on desktop) */
  .masonry-grid {
    column-count: 1;
    column-gap: 1.5rem;
  }

  @media (min-width: 768px) {
    .masonry-grid {
      column-count: 2;
    }
  }

  @media (min-width: 1024px) {
    .masonry-grid {
      column-count: 2;
    }
  }

  .masonry-item {
    margin: 0 0 1rem 0;
    break-inside: avoid;
    page-break-inside: avoid;
  }

  .masonry-item img {
    width: 100%;
    height: auto;
    display: block;
    transition: opacity 0.3s ease, transform 0.3s ease;
    image-orientation: from-image; /* Respect EXIF orientation */
  }

  .masonry-item:hover img {
    opacity: 0.95;
    transform: scale(1.01);
  }

  code {
    font-size: 0.875rem;
    background: var(--oat-200, #F5EFE4);
    padding: 0.125rem 0.375rem;
    border-radius: 0.25rem;
  }
</style>
