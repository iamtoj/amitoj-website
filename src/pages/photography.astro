---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import fs from 'fs';
import path from 'path';

// Read images from public/images/photography/ folder
// User exports photos there; /next sync picks them up
const photographyDir = 'public/images/photography';
let galleryImages: { src: string; alt: string; featured: boolean }[] = [];

try {
  const publicDir = path.join(process.cwd(), photographyDir);
  if (fs.existsSync(publicDir)) {
    const files = fs.readdirSync(publicDir)
      .filter(f => /\.(jpg|jpeg|png|webp|gif)$/i.test(f))
      .sort(); // Alphabetical - prefix with numbers for ordering

    galleryImages = files.map((file, i) => ({
      src: `/images/photography/${file}`,
      alt: file.replace(/\.[^.]+$/, '').replace(/[-_]/g, ' '),
      featured: i < 20 // First 20 are featured
    }));
  }
} catch (e) {
  // If folder doesn't exist yet, show placeholder message
}

const featuredImages = galleryImages.filter(img => img.featured);
const archiveImages = galleryImages.filter(img => !img.featured);
---

<Layout title="Photography | Amitoj Singh" description="Visual explorations. Seeing as practice.">
  <section class="container-zen section-zen">
    <div class="max-w-2xl">
      <h1 class="mb-8 text-balance">Photography</h1>

      <div class="accent-line mb-8"></div>

      <p class="text-lg text-ink-light mb-6">
        Seeing as practice. Light as language.
      </p>
    </div>
  </section>

  {galleryImages.length === 0 ? (
    <section class="container-zen section-zen border-t border-oat-300">
      <p class="text-ink-muted">
        Gallery coming soon. Export photos to <code>Work/Website/public/images/photography/</code>.
      </p>
    </section>
  ) : (
    <>
      {/* Featured Section */}
      <section class="container-zen section-zen border-t border-oat-300">
        <h2 class="text-2xl mb-8">Featured</h2>
        <div class="masonry-grid">
          {featuredImages.map((image) => (
            <figure class="masonry-item">
              <img
                src={image.src}
                alt={image.alt}
                loading="lazy"
              />
            </figure>
          ))}
        </div>
      </section>

      {/* Archive Section - only if there are non-featured images */}
      {archiveImages.length > 0 && (
        <section class="container-zen section-zen border-t border-oat-300">
          <h2 class="text-2xl mb-8">Archive</h2>
          <div class="masonry-grid masonry-small">
            {archiveImages.map((image) => (
              <figure class="masonry-item">
                <img
                  src={image.src}
                  alt={image.alt}
                  loading="lazy"
                />
              </figure>
            ))}
          </div>
        </section>
      )}
    </>
  )}

  <section class="container-zen section-zen border-t border-oat-300 bg-oat-100">
    <div class="max-w-2xl">
      <h2 class="text-2xl mb-6">Inquiries</h2>

      <p class="text-ink-light mb-8">
        For prints, licensing, or collaboration inquiries, please get in touch.
      </p>

      <a href="/contact" class="text-ink hover:text-ink-light no-underline">
        Contact &rarr;
      </a>
    </div>
  </section>
</Layout>

<style>
  /* Masonry grid using CSS columns */
  .masonry-grid {
    column-count: 2;
    column-gap: 1rem;
  }

  @media (min-width: 768px) {
    .masonry-grid {
      column-count: 3;
    }
  }

  @media (min-width: 1024px) {
    .masonry-grid {
      column-count: 4;
    }
  }

  /* Smaller grid for archive */
  .masonry-small {
    column-count: 3;
  }

  @media (min-width: 768px) {
    .masonry-small {
      column-count: 4;
    }
  }

  @media (min-width: 1024px) {
    .masonry-small {
      column-count: 5;
    }
  }

  .masonry-item {
    margin: 0 0 1rem 0;
    break-inside: avoid;
    page-break-inside: avoid;
  }

  .masonry-item img {
    width: 100%;
    height: auto;
    display: block;
    transition: opacity 0.3s ease, transform 0.3s ease;
  }

  .masonry-item:hover img {
    opacity: 0.95;
    transform: scale(1.01);
  }

  code {
    font-size: 0.875rem;
    background: var(--oat-200, #F5EFE4);
    padding: 0.125rem 0.375rem;
    border-radius: 0.25rem;
  }
</style>
